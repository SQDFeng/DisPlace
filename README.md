# DisPlace 插件
这是对 [MakePlacePlugin](https://github.com/jawslouis/MakePlacePlugin) 的个人用途修改版本。我不保证此插件能正常工作，也不承诺会持续更新，因为我主要是想启用 MakePlace 中被禁用的功能，并让插件适配当前版本的 FFXIV。
这是一个用于自动保存和加载 FFXIV 房屋家具布局的插件。它还能导入/导出已停止维护的原始 [MakePlace](https://jawslouis.itch.io/makeplace) 程序以及仍在维护的 [ReMakePlace](https://github.com/RemakePlace/app) 的布局文件，因为它们使用相同的文件格式。

## 目录
* [安装](#installation)
* [使用方法](#usage)
* [致谢](#credits)

## 安装

* 你需要使用 [FFXIV Quick Launcher](https://goatcorp.github.io/) 来运行游戏。这允许使用第三方插件（例如本插件）。
* 在聊天框中输入命令 `/xlsettings`，或按 `Esc` 键并选择 Dalamud 设置，以打开设置窗口。
* 点击“实验性”选项卡。
* 在“自定义插件仓库”部分的新行中粘贴以下网址：```https://raw.githubusercontent.com/SQDFeng/DisPlace/master/DisPlacePlugin.json```
* 点击 `+` 按钮。确保新条目已勾选“启用”。
* 点击“保存并关闭”按钮。
* 在聊天框中输入 `/xlplugins`，或按 `Esc` 键并选择 Dalamud 插件，以打开插件窗口。
* 搜索 “DisPlace Plugin” 并点击“安装”。

## 使用方法
输入 `/displace` 以打开插件界面。大部分功能仅在旋转家具模式下可用（房屋 → 室内/室外家具 → 点击“旋转”按钮）。

### 从游戏中保存布局
* 确保你处于家具模式。
* 点击 `另存为`，并指定文件名。完成！

### 将布局加载到游戏中
* 确保你处于**旋转**家具模式。
* 确保已勾选相关楼层。
* 确保所有必需的家具都已放置在房屋中：
  * 插件不会触碰你背包或储物柜中的家具。
  * 插件不会为你染色家具。
  * 如果你重新加载设计，列表中的所有家具应显示为白色，而不是灰色。
* 点击 `从文件加载` 并选择 .json 设计文件。坐等布局放置完成！
  * 你的布局也会出现在插件中。
  * 如果发生崩溃，请查看 [FAQ 的这一部分](#why-does-the-plugin-crash-sometimes-when-applying-a-layout)：

### 界面
* **保存**：将布局保存到当前文件。首次启动插件时此选项不可用，因为尚未指定文件。若要将外部和内部保存到同一文件，只需先进入室内保存一次，再外出后保存到同一文件即可。
* **另存为**：将布局保存到指定文件。
* **加载**：从当前文件加载并应用布局。插件会检查房屋中当前已放置的家具是否与布局匹配，同时也会检查染色是否匹配。所有未匹配的布局家具将显示为灰色。
* **从文件加载**：与“加载”相同，但从指定文件加载布局。
* **放置间隔**：应用整个布局时，每件家具放置之间的时间间隔。若设置过低（例如 200 毫秒），可能导致某些家具放置被遗漏。
* **标记家具**：在每件家具上方显示一个小提示框，并附带一个按钮，可将布局中的位置应用到该家具上。

## 常见问题（FAQ）
### 救命！插件无法正常工作。
虽然我们或许能帮上忙，但建议你先尝试原版插件（如果它已更新），看看问题是否依然存在。如果问题依旧，请创建 GitHub Issue 或在 [Discord](https://discord.gg/aMAVmaQAzY) 上发帖寻求故障排查帮助。

### 游戏语言不是英文时插件还能用吗？
可以！保存、加载和传输布局在所有语言下都能正常工作。

### 我能用它复制其他房屋的布局吗？
当然可以。与原版插件不同，我们认为这种限制毫无道理。信息应当自由流通，以便他人学习和研究——你可以把它想象成一个远没那么重要的 sci-hub.ru。

### 插件会使用我背包或储物柜里的家具吗？
它只使用房屋中已放置的家具，不会触碰你的背包或储物柜，因此不用担心弄乱物品管理。此外，由于放置家具会使其绑定且无法交易，最好由玩家亲自操作。

### 使用这个插件安全吗？
大概率是安全的，尽管它确实允许你以正常情况下不可能的方式放置家具。

### 为什么应用布局并退出家具菜单后，家具会自动吸附回地板/墙壁？
物品有最小悬浮距离限制，低于此距离就会吸附回地面。同样，壁挂物品与墙壁或隔板之间也有最小距离要求，否则会自动吸附到墙上。很遗憾，这是游戏本身的限制，你需要调整你的设计。

如果使用 MakePlace 应用程序，你可以在设置中启用 `最小悬浮距离`，在放置家具时获得视觉提示。

### 为什么插件在应用布局时有时会崩溃？
请确保以下几点：
- 鼠标光标不要悬停在任何物品上（即使物品位于插件 UI 后方）。应用布局时，悬停在物品上可能会导致游戏代码与放置过程冲突。
- 角色不要挡在家具即将放置的位置上。
- 不要将超过 10 件物品依附于另一件物品上（例如桌面上的摆件、隔板墙上的壁挂物品）。

很遗憾，上述问题目前无解，因为这与游戏本身的运行机制有关。


## 致谢
感谢 [NotNite](https://github.com/NotNite) 根据 Dalamud 服务条款强制重新开源了 MakePlace 插件。感谢 [MakePlacePlugin](https://github.com/jawslouis/MakePlacePlugin) 制作了如此优秀的插件。
本插件建立在另外三个优秀插件的基础之上：[HousingPos](https://github.com/Bluefissure/HousingPos)、[BDTH](https://github.com/LeonBlade/BDTHPlugin) 和 [HouseMate](https://github.com/lmcintyre/Housemate)。尤其是用户界面，大量借鉴了 HousingPos 的设计。
